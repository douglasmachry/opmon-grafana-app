{"version":3,"sources":["../src/apedex_ctrl.js"],"names":["MetricsPanelCtrl","_","Apedex","$scope","$injector","defaultsDeep","panel","panelDefaults","events","on","onDataReceived","bind","onInitEditMode","data","label","value","NaN","map","d","datapoints","reduce","result","val","zonesPredicates","satisfiedZone","acc","f","sz","tz","total","length","calcApedex","labelPredicates","text","color","render","addEditorTab","scope","elem","attrs","ctrl","find","css","templateUrl","T","Object","assign","before","Number","toPrecision","log","console","msg","x","labelSettings","fontSize","fontWeight","textTransform","valueSettings"],"mappings":"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","file":"apedex_ctrl.js","sourcesContent":["import { MetricsPanelCtrl } from 'app/plugins/sdk';\nimport _ from 'lodash';\n\n\nexport class Apedex extends MetricsPanelCtrl {\n  constructor($scope, $injector) {\n    super($scope, $injector);\n    _.defaultsDeep(this.panel, panelDefaults);\n\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\n    this.data = [{ label: 'No data', value: NaN }]\n  }\n\n  onDataReceived(data=[]) {\n    this.data = data.map(d => (\n      d.datapoints.reduce((result, [val, data]) => (\n        zonesPredicates(this.panel.satisfiedZone).reduce((acc, f) => f(acc, val), result)\n      ), { sz: 0, tz: 0, total: d.datapoints.length })\n    ))\n    .map(data => ({\n      value: calcApedex(data.sz, data.tz, data.total)\n    }))\n    .map(data => ({\n      value: data.value,\n      label: labelPredicates().reduce((acc, f) => f(acc, data.value), { text: 'Excellent', color: '#258e2d' })\n    }))\n\n    this.render()\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/apdex/editor.html', 2);\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    this.events.on('render', () => {\n      elem.find('.panel-container').css('background-color', this.data.reduce((_, d) => (d.label.color), '#000'))\n      elem.find('.panel-title').css('color', '#FFF')\n    })\n  }\n}\n\nApedex.templateUrl = 'module.html';\n\nconst zonesPredicates = (T) => [\n  (acc, val) => val <= T\n    ? Object.assign(acc, { sz: acc.sz + 1 })\n    : acc,\n  (acc, val) => val > T && val <= T * 4\n    ? Object.assign(acc, { tz: acc.tz + 1 })\n    : acc,\n]\n\nconst labelPredicates = () => [\n  (before, val) => val <= 0.93 ? { text: 'Good', color: '#89ca0b' } : before,\n  (before, val) => val <= 0.84 ? { text: 'Fair', color: '#ffba10' } : before,\n  (before, val) => val <= 0.69 ? { text: 'Poor', color: '#f76522' } : before,\n  (before, val) => val <= 0.49 ? { text: 'Unacceptable', color: '#cf2122' } : before,\n]\n\nconst calcApedex = (sz, tz, total) => (\n  Number(((sz + (tz / 2)) / total).toPrecision(2))\n)\n\nconst log = msg => x => (console.log(msg, x), x)\n\nconst panelDefaults = {\n  labelSettings: {\n    fontSize: '30px',\n    fontWeight: 'bold',\n    color: 'white',\n    textTransform: 'uppercase'\n  },\n  valueSettings: {\n    fontSize: '20px',\n    fontWeight: 'normal',\n    color: 'white',\n    textTransform: 'normal'\n  },\n  satisfiedZone: 5\n};\n\n"]}