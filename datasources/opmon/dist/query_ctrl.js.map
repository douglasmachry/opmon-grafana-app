{"version":3,"sources":["../src/query_ctrl.js"],"names":["QueryCtrl","c","OpMonDatasourceQueryCtrl","$scope","$injector","uiSegmentSrv","scope","target","host","datasource","DEFAULT_HOST","hostgroup","DEFAULT_HOSTGROUP","service","DEFAULT_SERVICE","servicegroup","DEFAULT_SERVICEGROUP","serviceCatalog","DEFAULT_SERVICECATALOG","metric","DEFAULT_METRIC","mode","$root","MODE_AVAIL","objecttype","DEFAULT_OBJECT_TYPE","extended_state","DEFAULT_EXTENDED_STATE","resultformat","DEFAULT_RESULT_FORMAT","timecut","DEFAULT_TIMECUT","groupby","editorModes","value","text","MODE_CP","MODE_SYSTEM","MODE_STATUS","editorMode","AVAIL","CP","SYSTEM","STATUS","slaPropertyList","name","property","ackFilters","resultFormats","console","log","onChangeInternal","metricFindData","then","transformToSegments","panelCtrl","refresh","templateUrl"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["import {QueryCtrl} from 'app/plugins/sdk';\nimport './css/query-editor.css!'\nimport * as c from './constants';\n\nexport class OpMonDatasourceQueryCtrl extends QueryCtrl {\n\n  constructor($scope, $injector, uiSegmentSrv)  {\n    super($scope, $injector);\n\n    this.scope = $scope;\n    this.uiSegmentSrv     = uiSegmentSrv;\n    this.target.host      = this.target.host      || this.datasource.DEFAULT_HOST;\n    this.target.hostgroup = this.target.hostgroup || this.datasource.DEFAULT_HOSTGROUP;\n    this.target.service   = this.target.service   || this.datasource.DEFAULT_SERVICE;\n    this.target.servicegroup = this.target.servicegroup || this.datasource.DEFAULT_SERVICEGROUP;\n    this.target.serviceCatalog = this.target.serviceCatalog || this.datasource.DEFAULT_SERVICECATALOG;\n    this.target.metric = this.target.metric || this.datasource.DEFAULT_METRIC;\n    //this.target.timecut = this.target.timecut      || this.datasource.DEFAULT_TIMECUT;\n    this.target.mode = (this.$scope.$root.mode) ? (this.$scope.$root.mode) : (this.target.mode || c.MODE_AVAIL);\n    //this.target.groupby      = this.target.groupby      || 'none';\n    //this.target.resultFormat = this.target.resultFormat      || this.datasource.DEFAULT_RESULT_FORMAT;\n    this.target.objecttype = (this.$scope.$root.objecttype) ? this.$scope.$root.objecttype : (this.target.objecttype || this.datasource.DEFAULT_OBJECT_TYPE);\n    this.target.extended_state = this.$scope.$root.extended_state ? this.$scope.$root.extended_state : this.target.extended_state || this.datasource.DEFAULT_EXTENDED_STATE;\n    //this.target.fill      = this.target.fill      || 'fill';\n    this.target.resultformat = (this.$scope.$root.resultformat) ? (this.$scope.$root.resultformat) : (this.target.resultformat || this.datasource.DEFAULT_RESULT_FORMAT);\n\n    this.target.timecut = (this.$scope.$root.timecut) ? this.$scope.$root.timecut : (this.target.timecut || this.datasource.DEFAULT_TIMECUT);\n    this.target.groupby = (this.$scope.$root.groupby) ? this.$scope.$root.groupby : (this.target.groupby || 'none');\n\n    this.editorModes = [\n      {value: 'avail',      text: 'Availability',        mode: c.MODE_AVAIL},\n      {value: 'cp',       text: 'Capacity',     mode: c.MODE_CP},\n      {value: 'system',       text: 'System',     mode: c.MODE_SYSTEM},\n      {value: 'display_status',       text: 'Status',     mode: c.MODE_STATUS},\n     // {value: 'avail_service', text: 'Availability - Service', mode: c.MODE_AVAIL_SERVICE},\n //     {value: 'itemid',    text: 'Item ID',     mode: c.MODE_ITEMID},\n   //   {value: 'triggers',  text: 'Triggers',    mode: c.MODE_TRIGGERS}\n    ];\n\n\n    this.$scope.editorMode = {\n      AVAIL: c.MODE_AVAIL,\n      CP: c.MODE_CP,\n      SYSTEM: c.MODE_SYSTEM,\n      STATUS: c.MODE_STATUS\n //     ITEMID: c.MODE_ITEMID,\n  //    TRIGGERS: c.MODE_TRIGGERS\n    };\n\n\n    /*if (this.$scope.$root.p) {\n      this.$scope.$root.p.push(this.panelCtrl)\n    } else {\n      this.$scope.$root.p = [this.panelCtrl]\n    }*/\n\n\n    this.slaPropertyList = [\n      {name: \"Status\", property: \"status\"},\n      {name: \"SLA\", property: \"sla\"},\n      {name: \"OK time\", property: \"okTime\"},\n      {name: \"Problem time\", property: \"problemTime\"},\n      {name: \"Down time\", property: \"downtimeTime\"}\n    ];\n\n    this.ackFilters = [\n      {text: 'all triggers', value: 2},\n      {text: 'unacknowledged', value: 0},\n      {text: 'acknowledged', value: 1},\n    ];\n\n    this.resultFormats = [{ text: 'Time series', value: 'time_series' }, { text: 'Table', value: 'table' }];\n\n\n\n  }\n\n  /**\n   * Switch query editor to specified mode.\n   * Modes:\n   *  0 - items\n   *  1 - IT services\n   *  2 - Text metrics\n   */\n  switchValue(name,value) {\n    this.target[name] = value;\n    this.$scope.$root[name] = value;\n    if (name === 'mode' && value === c.MODE_CP && this.target.objecttype === 'Host') {\n      this.target.objecttype = \"Service\";\n    }\n    console.log(name,value);\n    //this.init();\n    this.onChangeInternal();\n  }\n\n  getHost() {\n    return this.datasource.metricFindData(\"host\", this.target, true)\n      .then(this.uiSegmentSrv.transformToSegments(false));\n  }\n\n  getHostGroup() {\n    return this.datasource.metricFindData(\"hostgroup\", this.target, true)\n      .then(this.uiSegmentSrv.transformToSegments(false));\n  }\n\n  getService() {\n    return this.datasource.metricFindData(\"service\", this.target, true)\n      .then(this.uiSegmentSrv.transformToSegments(false));\n  }\n\n  getServiceGroup() {\n    return this.datasource.metricFindData(\"servicegroup\", this.target, true)\n      .then(this.uiSegmentSrv.transformToSegments(false));\n  }\n\n  getServiceCatalog() {\n    return this.datasource.metricFindData(\"serviceCatalog\", this.target, true)\n      .then(this.uiSegmentSrv.transformToSegments(false));\n  }\n\n\n  getMetric() {\n    return this.datasource.metricFindData(\"metric\", this.target, true)\n      .then(this.uiSegmentSrv.transformToSegments(false));\n  }\n\n  getTimecut() {\n    return this.datasource.metricFindData(\"timecut\", this.target, true)\n      .then(this.uiSegmentSrv.transformToSegments(false));\n  }\n\n  onChangeInternal() {\n    //this.$scope.$root.p.forEach((e) => {\n    //  e.refresh()\n    //})\n    this.panelCtrl.refresh();\n  }\n\n  getCollapsedText() {\n    if(this.target.metric == this.datasource.DEFAULT_METRIC &&\n       this.target.host      == this.datasource.DEFAULT_HOST &&\n       this.target.service   == this.datasource.DEFAULT_SERVICE) {\n        return(\"click to edit query\");\n    }\n    return(this.target.metric\n           +': '+this.target.host\n           +' - '+this.target.service\n           );\n  }\n}\n\nOpMonDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n"]}