{"version":3,"sources":["../../../src/test/query_ctrl.js"],"names":["Object","defineProperty","exports","value","OpMonDatasourceQueryCtrl","undefined","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_sdk","require","_constants","c","_interopRequireWildcard","obj","__esModule","newObj","hasOwnProperty","call","default","_classCallCheck","instance","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","_QueryCtrl","$scope","$injector","uiSegmentSrv","_this","getPrototypeOf","scope","host","datasource","DEFAULT_HOST","service","DEFAULT_SERVICE","metric","DEFAULT_METRIC","mode","$root","MODE_AVAIL","objecttype","DEFAULT_OBJECT_TYPE","resultformat","DEFAULT_RESULT_FORMAT","timecut","DEFAULT_TIMECUT","groupby","editorModes","text","MODE_CP","MODE_SYSTEM","editorMode","AVAIL","CP","SYSTEM","slaPropertyList","name","property","ackFilters","resultFormats","switchValue","console","log","onChangeInternal","getHost","metricFindData","then","transformToSegments","getService","getMetric","getTimecut","panelCtrl","refresh","getCollapsedText","QueryCtrl","templateUrl"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.OpMonDatasourceQueryCtrl = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _sdk = require('app/plugins/sdk');\n\nrequire('./css/query-editor.css!');\n\nvar _constants = require('./constants');\n\nvar c = _interopRequireWildcard(_constants);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar OpMonDatasourceQueryCtrl = exports.OpMonDatasourceQueryCtrl = function (_QueryCtrl) {\n  _inherits(OpMonDatasourceQueryCtrl, _QueryCtrl);\n\n  function OpMonDatasourceQueryCtrl($scope, $injector, uiSegmentSrv) {\n    _classCallCheck(this, OpMonDatasourceQueryCtrl);\n\n    var _this = _possibleConstructorReturn(this, (OpMonDatasourceQueryCtrl.__proto__ || Object.getPrototypeOf(OpMonDatasourceQueryCtrl)).call(this, $scope, $injector));\n\n    _this.scope = $scope;\n    _this.uiSegmentSrv = uiSegmentSrv;\n    _this.target.host = _this.target.host || _this.datasource.DEFAULT_HOST;\n    _this.target.service = _this.target.service || _this.datasource.DEFAULT_SERVICE;\n    _this.target.metric = _this.target.metric || _this.datasource.DEFAULT_METRIC;\n    //this.target.timecut = this.target.timecut      || this.datasource.DEFAULT_TIMECUT;\n    _this.target.mode = _this.$scope.$root.mode ? _this.$scope.$root.mode : _this.target.mode || c.MODE_AVAIL;\n    //this.target.groupby      = this.target.groupby      || 'none';\n    //this.target.resultFormat = this.target.resultFormat      || this.datasource.DEFAULT_RESULT_FORMAT;\n    _this.target.objecttype = _this.$scope.$root.objecttype ? _this.$scope.$root.objecttype : _this.target.objecttype || _this.datasource.DEFAULT_OBJECT_TYPE;\n    //this.target.fill      = this.target.fill      || 'fill';\n    _this.target.resultformat = _this.$scope.$root.resultformat ? _this.$scope.$root.resultformat : _this.target.resultformat || _this.datasource.DEFAULT_RESULT_FORMAT;\n\n    _this.target.timecut = _this.$scope.$root.timecut ? _this.$scope.$root.timecut : _this.target.timecut || _this.datasource.DEFAULT_TIMECUT;\n    _this.target.groupby = _this.$scope.$root.groupby ? _this.$scope.$root.groupby : _this.target.groupby || 'none';\n\n    _this.editorModes = [{ value: 'avail', text: 'Availability', mode: c.MODE_AVAIL }, { value: 'cp', text: 'Capacity', mode: c.MODE_CP }, { value: 'system', text: 'System', mode: c.MODE_SYSTEM }];\n\n    _this.$scope.editorMode = {\n      AVAIL: c.MODE_AVAIL,\n      CP: c.MODE_CP,\n      SYSTEM: c.MODE_SYSTEM\n      //     ITEMID: c.MODE_ITEMID,\n      //    TRIGGERS: c.MODE_TRIGGERS\n    };\n\n    /*if (this.$scope.$root.p) {\n      this.$scope.$root.p.push(this.panelCtrl)\n    } else {\n      this.$scope.$root.p = [this.panelCtrl]\n    }*/\n\n    _this.slaPropertyList = [{ name: \"Status\", property: \"status\" }, { name: \"SLA\", property: \"sla\" }, { name: \"OK time\", property: \"okTime\" }, { name: \"Problem time\", property: \"problemTime\" }, { name: \"Down time\", property: \"downtimeTime\" }];\n\n    _this.ackFilters = [{ text: 'all triggers', value: 2 }, { text: 'unacknowledged', value: 0 }, { text: 'acknowledged', value: 1 }];\n\n    _this.resultFormats = [{ text: 'Time series', value: 'time_series' }, { text: 'Table', value: 'table' }];\n\n    return _this;\n  }\n\n  /**\n   * Switch query editor to specified mode.\n   * Modes:\n   *  0 - items\n   *  1 - IT services\n   *  2 - Text metrics\n   */\n\n\n  _createClass(OpMonDatasourceQueryCtrl, [{\n    key: 'switchValue',\n    value: function switchValue(name, value) {\n      this.target[name] = value;\n      this.$scope.$root[name] = value;\n      console.log(name, value);\n      //this.init();\n      this.onChangeInternal();\n    }\n  }, {\n    key: 'getHost',\n    value: function getHost() {\n      return this.datasource.metricFindData(\"host\", this.target, true).then(this.uiSegmentSrv.transformToSegments(false));\n    }\n  }, {\n    key: 'getService',\n    value: function getService() {\n      return this.datasource.metricFindData(\"service\", this.target, true).then(this.uiSegmentSrv.transformToSegments(false));\n    }\n  }, {\n    key: 'getMetric',\n    value: function getMetric() {\n      return this.datasource.metricFindData(\"metric\", this.target, true).then(this.uiSegmentSrv.transformToSegments(false));\n    }\n  }, {\n    key: 'getTimecut',\n    value: function getTimecut() {\n      return this.datasource.metricFindData(\"timecut\", this.target, true).then(this.uiSegmentSrv.transformToSegments(false));\n    }\n  }, {\n    key: 'onChangeInternal',\n    value: function onChangeInternal() {\n      //this.$scope.$root.p.forEach((e) => {\n      //  e.refresh()\n      //})\n      this.panelCtrl.refresh();\n    }\n  }, {\n    key: 'getCollapsedText',\n    value: function getCollapsedText() {\n      if (this.target.metric == this.datasource.DEFAULT_METRIC && this.target.host == this.datasource.DEFAULT_HOST && this.target.service == this.datasource.DEFAULT_SERVICE) {\n        return \"click to edit query\";\n      }\n      return this.target.metric + ': ' + this.target.host + ' - ' + this.target.service;\n    }\n  }]);\n\n  return OpMonDatasourceQueryCtrl;\n}(_sdk.QueryCtrl);\n\nOpMonDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n//# sourceMappingURL=query_ctrl.js.map\n"]}