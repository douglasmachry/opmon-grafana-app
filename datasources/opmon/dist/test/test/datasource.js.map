{"version":3,"sources":["../../../src/test/datasource.js"],"names":["Object","defineProperty","exports","value","OpMonDatasource","undefined","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_lodash","require","_lodash2","_interopRequireDefault","_constants","c","_interopRequireWildcard","obj","__esModule","newObj","hasOwnProperty","call","default","_classCallCheck","instance","TypeError","instanceSettings","$q","backendSrv","templateSrv","type","url","name","q","headers","basicAuth","DEFAULT_HOST","DEFAULT_SERVICE","DEFAULT_METRIC","DEFAULT_TIMECUT","DEFAULT_RESULT_FORMAT","DEFAULT_OBJECT_TYPE","query","options","buildQueryParameters","targets","filter","t","hide","host","service","metric","when","data","start","Number","range","from","toDate","getTime","toFixed","end","to","x","mode","MODE_SYSTEM","_fixup_regex","getAdhocFilters","adhocFilters","doRequest","method","dataQueryMapper","result","k","res","alias","scopedVars","tag_host","tag_service","tag_metric","tag_label","replace","datapoints","y","pop","fill","factor","eval","NaN","push","annotationQuery","annotation","datasource","enable","iconColor","rangeRaw","then","matches","match","values","split","join","testDatasource","response","status","message","title","metricFindQuery","interpolated","mapToTextValue","metricFindData","prependVariables","This","mapper","objecttype","Error","requestOptions","_requestOptions","datasourceRequest","variables","unshift","text","map","d","isObject","withCredentials","_this","MODE_CP","MODE_AVAIL","groupby","timecut","resultformat","refId","getTagKeys","_this2","Promise","resolve","reject","getTagValues","_this3","Authorization"],"mappings":"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","file":"datasource.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.OpMonDatasource = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _lodash = require('lodash');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _constants = require('./constants');\n\nvar c = _interopRequireWildcard(_constants);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar OpMonDatasource = exports.OpMonDatasource = function () {\n  function OpMonDatasource(instanceSettings, $q, backendSrv, templateSrv) {\n    _classCallCheck(this, OpMonDatasource);\n\n    this.type = instanceSettings.type;\n    this.url = instanceSettings.url + '/opmon/ws/grafana.php?q=';\n    this.name = instanceSettings.name;\n    this.q = $q;\n    this.backendSrv = backendSrv;\n    this.templateSrv = templateSrv;\n    this.headers = { 'Content-Type': 'application/json' };\n    if (typeof instanceSettings.basicAuth === 'string' && instanceSettings.basicAuth.length > 0) {\n      this.headers['Authorization'] = instanceSettings.basicAuth;\n    }\n    this.DEFAULT_HOST = \"- select host -\";\n    this.DEFAULT_SERVICE = \"- select service -\";\n    this.DEFAULT_METRIC = \"- all -\";\n    this.DEFAULT_TIMECUT = \"24x7\";\n    this.DEFAULT_RESULT_FORMAT = 'time_series';\n    this.DEFAULT_OBJECT_TYPE = 'Host';\n  }\n\n  /* fetch pnp rrd data */\n\n\n  _createClass(OpMonDatasource, [{\n    key: 'query',\n    value: function query(options) {\n      var query = this.buildQueryParameters(options);\n      query.targets = query.targets.filter(function (t) {\n        return !t.hide;\n      });\n      query.targets = query.targets.filter(function (t) {\n        return t.host;\n      }); /* hide querys without a host filter */\n      query.targets = query.targets.filter(function (t) {\n        return t.service;\n      }); /* hide querys without a service filter */\n      query.targets = query.targets.filter(function (t) {\n        return t.metric;\n      }); /* hide querys without a metric filter */\n\n      if (query.targets.length <= 0) {\n        return this.q.when({ data: [] });\n      }\n\n      query.start = Number(options.range.from.toDate().getTime() / 1000).toFixed();\n      query.end = Number(options.range.to.toDate().getTime() / 1000).toFixed();\n\n      /* fixup regex syntax in query targets */\n      for (var x = 0; x < query.targets.length; x++) {\n        var target = query.targets[x];\n        if (target.host == this.DEFAULT_HOST || target.mode == c.MODE_SYSTEM) {\n          target.host = '';\n        }\n        if (target.service == this.DEFAULT_SERVICE || target.mode == c.MODE_SYSTEM) {\n          target.service = '';\n        }\n        if (target.metric == this.DEFAULT_METRIC) {\n          target.metric = '';\n        }\n\n        target.host = this._fixup_regex(target.host);\n        target.service = this._fixup_regex(target.service);\n        target.metric = this._fixup_regex(target.metric);\n\n        //target.host_id =  this.rawdata[target.refId]['host'].filter((cur) => (cur.text == target.host)).pop().value;\n        //target.service_id = this.rawdata[target.refId]['service'].filter((cur) => (cur.text == target.service)).pop().value;\n        //target.metric_id = this.rawdata[target.refId]['metric'].filter((cur) => (cur.text == target.metric)).pop().value;\n      }\n\n      if (this.templateSrv.getAdhocFilters) {\n        query.adhocFilters = this.templateSrv.getAdhocFilters(this.name);\n      } else {\n        query.adhocFilters = [];\n      }\n\n      return this.doRequest({\n        url: this.url + '/query',\n        data: query,\n        method: 'POST'\n      });\n\n      /*var This = this;\n      var requestOptions = this._requestOptions({\n        url: this.url + '/index.php/api/metrics',\n        data: query,\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' }\n      });\n      return this.backendSrv.datasourceRequest(requestOptions)\n                            .then(function(result) {\n                              return(This.dataQueryMapper(result, options))\n                            });*/\n    }\n\n    /* maps the result data from pnp into grafana data format */\n\n  }, {\n    key: 'dataQueryMapper',\n    value: function dataQueryMapper(result, options) {\n      var data = { data: [] };\n      if (!result || !result.data || !result.data.targets) {\n        return data;\n      }\n      for (var x = 0; x < result.data.targets.length; x++) {\n        for (var k = 0; k < result.data.targets[x].length; k++) {\n          var target = options.targets[x];\n          var res = result.data.targets[x][k];\n          var alias = target.metric;\n          if (target.alias) {\n            alias = target.alias;\n            var scopedVars = {\n              tag_host: { value: res.host },\n              tag_service: { value: res.service },\n              tag_metric: { value: res.metric },\n              tag_label: { value: res.metric }\n            };\n            alias = this.templateSrv.replace(alias, scopedVars);\n          }\n          var datapoints = res.datapoints;\n          var length = datapoints.length;\n          // remove the last few \"null\" values from the series because the last value is quite often null\n          // and would break current value in legend tables\n          for (var y = 1; y < 5; y++) {\n            if (length > y && datapoints[length - y][0] === null) {\n              datapoints.pop();\n            } else {\n              break;\n            }\n          }\n          var length = datapoints.length;\n          var fill = options.targets[x].fill;\n          if (fill != \"fill\") {\n            if (fill == \"zero\") {\n              fill = 0;\n            }\n            if (fill == \"gap\") {\n              fill = undefined;\n            }\n            for (var y = 0; y < length; y++) {\n              if (datapoints[y][0] === null) {\n                datapoints[y][0] = fill;\n              }\n            }\n          }\n          if (options.targets[x].factor && options.targets[x].factor != \"\") {\n            var factor = eval(options.targets[x].factor);\n            if (factor != NaN && factor != 1) {\n              for (var y = 0; y < length; y++) {\n                if (datapoints[y][0] !== null) {\n                  datapoints[y][0] *= factor;\n                }\n              }\n            }\n          }\n          data.data.push({\n            \"target\": alias,\n            \"datapoints\": datapoints\n          });\n        }\n      }\n      return data;\n    }\n  }, {\n    key: 'annotationQuery',\n    value: function annotationQuery(options) {\n      var query = this.templateSrv.replace(options.annotation.query, {}, 'glob');\n      var annotationQuery = {\n        range: options.range,\n        annotation: {\n          name: options.annotation.name,\n          datasource: options.annotation.datasource,\n          enable: options.annotation.enable,\n          iconColor: options.annotation.iconColor,\n          query: query\n        },\n        rangeRaw: options.rangeRaw\n      };\n\n      return this.doRequest({\n        url: this.url + '/annotations',\n        method: 'POST',\n        data: annotationQuery\n      }).then(function (result) {\n        return result.data;\n      });\n    }\n\n    /* convert list selection into regular expression\n     * in:  /^{a,b,c}$/\n     * out: /^(a|b|c)$/\n     */\n\n  }, {\n    key: '_fixup_regex',\n    value: function _fixup_regex(value) {\n      if (value == undefined || value == null) {\n        return value;\n      }\n      var matches = value.match(/^\\/?\\^?\\{(.*)\\}\\$?\\/?$/);\n      if (!matches) {\n        return value;\n      }\n      var values = matches[1].split(/,/);\n      for (var x = 0; x < values.length; x++) {\n        values[x] = values[x].replace(/\\//, '\\\\/');\n      }\n      return '/^(' + values.join('|') + ')$/';\n    }\n  }, {\n    key: 'testDatasource',\n    value: function testDatasource() {\n      return this.doRequest({\n        url: this.url + '/',\n        method: 'GET'\n      }).then(function (response) {\n        if (response.status === 200) {\n          return { status: \"success\", message: \"Data source is working\", title: \"Success\" };\n        }\n      });\n    }\n    /* called from the dashboard templating engine to fill template variables\n     * parses simple statements into proper data requests\n     * query syntax: <type> [where <expr>]\n     * ex.: host\n     * ex.: service where host = localhost\n     * ex.: label where host = localhost and service = ping\n     */\n\n  }, {\n    key: 'metricFindQuery',\n    value: function metricFindQuery(query) {\n      /*var This = this;\n      var type;\n      var options = {};\n      var query = query_string.split(/\\s+/);\n      if(query[0]) {\n        type = query.shift().replace(/s$/, \"\");\n      }\n      // parse simple where statements\n      if(query[0] != undefined) {\n        if(query[0].toLowerCase() != \"where\") {\n          throw new Error(\"query syntax error, expecting WHERE\");\n        }\n        query.shift();\n         while(query.length >= 3) {\n          var t   = query.shift().toLowerCase();\n          var op  = query.shift().toLowerCase();\n          var val = query.shift();\n          if(op != \"=\") {\n            throw new Error(\"query syntax error, operator must be '='\");\n          }\n          options[t] = val;\n           if(query[0] != undefined) {\n            if(query[0].toLowerCase() == 'and') {\n              query.shift();\n            } else {\n              throw new Error(\"query syntax error, expecting AND\");\n            }\n          }\n        }\n         // still remaining filters?\n        if(query.length > 0) {\n          throw new Error(\"query syntax error\");\n        }\n      }\n      return(This.metricFindData(type, options, false));*/\n      var interpolated = {\n        target: this.templateSrv.replace(query, null, 'regex')\n      };\n\n      return this.doRequest({\n        url: this.url + '/search',\n        data: interpolated,\n        method: 'POST'\n      }).then(this.mapToTextValue);\n    }\n\n    /* used from the query editor to get lists of objects of given type */\n\n  }, {\n    key: 'metricFindData',\n    value: function metricFindData(type, options, prependVariables) {\n      var This = this;\n      var mapper;\n      var url;\n      var data = {};\n      if (type == \"host\") {\n        url = This.url + '/hosts';\n        mapper = This.mapToTextValue;\n      } else if (type == \"service\") {\n        url = This.url + '/services';\n        data.host = This._fixup_regex(This.templateSrv.replace(options.host));\n        //data.host_id = This.rawdata[options.refId]['host'].filter((cur) => (cur.text == data.host)).pop().value;\n        mapper = This.mapToTextValue;\n        //if(!data.host) { data.host = '/.*/'; }\n      } else if (type == \"metric\" || type == \"label\") {\n        url = This.url + '/metrics';\n\n        if (options.mode == c.MODE_SYSTEM) {\n          data.host = '';\n          data.service = '';\n        } else {\n          data.host = This._fixup_regex(This.templateSrv.replace(options.host));\n          data.service = This._fixup_regex(This.templateSrv.replace(options.service));\n        }\n\n        data.objecttype = This._fixup_regex(This.templateSrv.replace(options.objecttype));\n        data.mode = options.mode;\n        mapper = This.mapToTextValue;\n        //if(!data.host)    { data.host    = '/.*/'; }\n        //if(!data.service) { data.service = '/.*/'; }\n      } else if (type == \"timecut\") {\n        url = This.url + '/timecuts';\n        mapper = This.mapToTextValue;\n      }\n\n      if (url == undefined) {\n        throw new Error(\"query syntax error, got no url, unknown type: \" + type);\n      }\n\n      var requestOptions = This._requestOptions({\n        url: url,\n        data: data,\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' }\n      });\n\n      return This.backendSrv.datasourceRequest(requestOptions).then(mapper).then(function (data) {\n        /* prepend templating variables */\n        if (prependVariables) {\n          for (var x = 0; x < This.templateSrv.variables.length; x++) {\n            data.unshift({ text: '/^$' + This.templateSrv.variables[x].name + '$/',\n              value: '/^$' + This.templateSrv.variables[x].name + '$/' });\n          }\n        }\n        if (type == 'metric') {\n          data.unshift({ text: This.DEFAULT_METRIC, value: \"\" });\n        }\n        return data;\n      });\n    }\n  }, {\n    key: 'mapToTextValue',\n    value: function mapToTextValue(result) {\n      return _lodash2.default.map(result.data, function (d, i) {\n        if (d && d.text && d.value) {\n          return { text: d.text, value: d.value };\n        } else if (_lodash2.default.isObject(d)) {\n          return { text: d, value: i };\n        }\n        return { text: d, value: d };\n      });\n    }\n\n    /*mapToTextValueHost(result) {\n      return _.map(result.data.hosts, (d, i) => {\n        return { text: d.name, value: d.name };\n      });\n    }\n     mapToTextValueService(result) {\n      return _.map(result.data.services, (d, i) => {\n        return { text: (d.servicedesc || d.name), value: d.name };\n      });\n    }\n     mapToTextValuePerflabel(result) {\n      return _.map(result.data.labels, (d, i) => {\n        return { text: (d.label || d.name), value: (d.label || d.name) };\n      });\n    }*/\n\n  }, {\n    key: 'doRequest',\n    value: function doRequest(options) {\n      options.withCredentials = this.withCredentials;\n      options.headers = this.headers;\n\n      return this.backendSrv.datasourceRequest(options);\n    }\n  }, {\n    key: 'buildQueryParameters',\n    value: function buildQueryParameters(options) {\n      var _this = this;\n\n      //remove placeholder targets\n\n      options.targets = _lodash2.default.filter(options.targets, function (target) {\n        if (target.mode == c.MODE_CP || target.mode == c.MODE_AVAIL) {\n          return target.host !== _this.DEFAULT_HOST;\n        } else {\n          return true;\n        }\n      });\n\n      options.targets = _lodash2.default.filter(options.targets, function (target) {\n        if (target.mode == c.MODE_CP) {\n          return target.service !== _this.DEFAULT_SERVICE;\n        } else {\n          return true;\n        }\n      });\n\n      // options.targets = _.filter(options.targets, target => {\n      //  return target.resultFormat !== this.DEFAULT_RESULT_FORMAT;\n      //});\n      //options.targets = _.filter(options.targets, target => {\n      //  return target.metric !== this.DEFAULT_METRIC;\n      //});\n\n      var targets = _lodash2.default.map(options.targets, function (target) {\n        return {\n          host: _this.templateSrv.replace(_this.templateSrv.replace(target.host, options.scopedVars)),\n          service: _this.templateSrv.replace(_this.templateSrv.replace(target.service, options.scopedVars)),\n          metric: _this.templateSrv.replace(_this.templateSrv.replace(target.metric, options.scopedVars)),\n          alias: _this.templateSrv.replace(_this.templateSrv.replace(target.alias, options.scopedVars)),\n          groupby: _this.templateSrv.replace(_this.templateSrv.replace(target.groupby, options.scopedVars)),\n          timecut: _this.templateSrv.replace(_this.templateSrv.replace(target.timecut, options.scopedVars)),\n          resultformat: _this.templateSrv.replace(_this.templateSrv.replace(target.resultformat, options.scopedVars)),\n          objecttype: _this.templateSrv.replace(_this.templateSrv.replace(target.objecttype, options.scopedVars)),\n          mode: target.mode,\n          //fill: this.templateSrv.replace(this.templateSrv.replace(target.fill, options.scopedVars)),\n          //factor: this.templateSrv.replace(this.templateSrv.replace(target.factor, options.scopedVars)),\n          refId: target.refId,\n          hide: target.hide\n        };\n      });\n\n      options.targets = targets;\n\n      return options;\n    }\n  }, {\n    key: 'getTagKeys',\n    value: function getTagKeys(options) {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this2.doRequest({\n          url: _this2.url + '/tag-keys',\n          method: 'POST',\n          data: options\n        }).then(function (result) {\n          return resolve(result.data);\n        });\n      });\n    }\n  }, {\n    key: 'getTagValues',\n    value: function getTagValues(options) {\n      var _this3 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this3.doRequest({\n          url: _this3.url + '/tag-values',\n          method: 'POST',\n          data: options\n        }).then(function (result) {\n          return resolve(result.data);\n        });\n      });\n    }\n  }, {\n    key: '_requestOptions',\n    value: function _requestOptions(options) {\n      options = options || {};\n      options.headers = options.headers || {};\n      if (this.basicAuth || this.withCredentials) {\n        options.withCredentials = true;\n      }\n      if (this.basicAuth) {\n        options.headers.Authorization = this.basicAuth;\n      }\n      return options;\n    }\n  }]);\n\n  return OpMonDatasource;\n}();\n//# sourceMappingURL=datasource.js.map\n"]}